res = rep(0, nsim)
for(i in 1:nsim){
Z = rnbinom(n,1,p)
res[i] = sqrt(n)/sig*(mean(Z) - mu)
}
hist(res,100,freq=FALSE)
x = seq(-3,3,0.01)
lines(x,dnorm(x))
nsim = 5000
n = 100
p = 0.07
mu = (1-p)/p
sig = sqrt((1-p)/p^2)
res = rep(0, nsim)
for(i in 1:nsim){
Z = rnbinom(n,1,p)
res[i] = sqrt(n)/sig*(mean(Z) - mu)
}
hist(res,100,freq=FALSE)
x = seq(-3,3,0.01)
lines(x,dnorm(x))
qqnorm(res)
nsim = 500
n = 100
p = 0.07
mu = (1-p)/p
sig = sqrt((1-p)/p^2)
res = rep(0, nsim)
for(i in 1:nsim){
Z = rnbinom(n,1,p)
res[i] = sqrt(n)/sig*(mean(Z) - mu)
}
hist(res,100,freq=FALSE)
x = seq(-3,3,0.01)
lines(x,dnorm(x))
qqnorm(res)
nsim = 5
n = 100
p = 0.07
mu = (1-p)/p
sig = sqrt((1-p)/p^2)
res = rep(0, nsim)
for(i in 1:nsim){
Z = rnbinom(n,1,p)
res[i] = sqrt(n)/sig*(mean(Z) - mu)
}
hist(res,100,freq=FALSE)
x = seq(-3,3,0.01)
lines(x,dnorm(x))
qqnorm(res)
nsim = 500
n = 100
p = 0.07
mu = (1-p)/p
sig = sqrt((1-p)/p^2)
res = rep(0, nsim)
for(i in 1:nsim){
Z = rnbinom(n,1,p)
res[i] = sqrt(n)/sig*(mean(Z) - mu)
}
hist(res,100,freq=FALSE)
x = seq(-3,3,0.01)
lines(x,dnorm(x))
qqnorm(res)
# Many simulations aim to estimate an average
# the following code block estimates the variance of a negative binomial distribution
nsim = 500
n = 3
p = 0.07
mu = (1-p)/p
var = rep(0, nsim)
for(i in 1:500){
Z = rnbinom(n,1,p)
var[i] = mean((Z-mu)^2)
}
mean(var)
# Many simulations aim to estimate an average
# the following code block estimates the variance of a negative binomial distribution
nsim = 500
n = 300
p = 0.07
mu = (1-p)/p
var = rep(0, nsim)
for(i in 1:500){
Z = rnbinom(n,1,p)
var[i] = mean((Z-mu)^2)
}
mean(var)
nsim = 5000
n = 3
p = 0.07
mu = (1-p)/p
var = rep(0, nsim)
for(i in 1:500){
Z = rnbinom(n,1,p)
var[i] = mean((Z-mu)^2)
}
mean(var)
nsim = 5000
n = 3
p = 0.07
mu = (1-p)/p
var = rep(0, nsim)
for(i in 1:500){
Z = rnbinom(n,1,p)
var[i] = mean((Z-mu)^2)
}
mean(var)
# the following code block estimates the variance of a negative binomial distribution
nsim = 5000
n = 3
p = 0.07
mu = (1-p)/p
var = rep(0, nsim)
for(i in 1:500){
Z = rnbinom(n,1,p)
var[i] = ((Z-mu)^2)
}
mean(var)
warnings()
# Many simulations aim to estimate an average
# the following code block estimates the variance of a negative binomial distribution
nsim = 5000
n = 3
p = 0.07
mu = (1-p)/p
var = rep(0, nsim)
for(i in 1:500){
Z = rnbinom(n,1,p)
var[i] = mean((Z-mu)^2)
}
mean(var)
q()
# Installing bioconductor
source("http://bioconductor.org/biocLite.R")
biocLite()
#Installing ggplot2
install.packages("ggplot2" , "reshape2")
library(ggplot2)
A=matrix(c(0,0,0,-1,0,0,0,-1,-1,1,0,-1,-1,1,0,-1),4,4,byrow=TRUE)
A
A%*%A
A%*%A%*%A
A%*%A%*%A%*%A
TRUE
sprintf('I love %s','hza')
?read.table
?optim
nbinom?
q
?nbinom
dnegbinom
?dnegbinom
?dnbinom
?optim
?dnbinom
?optim
?optim
?sample
library(topGO)
> if (!requireNamespace("BiocManager", quietly=TRUE)) + install.packages("BiocManager") > BiocManager::install("topGO")
requireNameSpace("BiocManager",quietly=TRUE)
requireNamespace("BiocManager",quietly=TRUE)
requireNamespace("BiocManager")
BiocManager::install("topGO")
# topGO practice
library(topGO)
library(ALL)
data(ALL)
data(geneList)
library(ALL)
install.packages(ALL)
BiocManager::install("ALL")
# topGO practice
library(topGO)
library(ALL)
data(ALL)
data(geneList)
?paste
geneList
annotation(ALL)
affyLib <- paste(annotation(ALL), "db", sep = ".")
library(package = affyLib, character.only = TRUE)
sampleGOdata = new("topGOdata", description = "Simple session", ontology = "BP",
allGenes = geneList, geneSel = topDiffGenes, nodeSize = 10,
annot = annFUN.db, affyLib = affyLib)
BiocManager::install("hgu95av2.db")
affyLib <- paste(annotation(ALL), "db", sep = ".")
library(package = affyLib, character.only = TRUE)
sampleGOdata = new("topGOdata", description = "Simple session", ontology = "BP",
allGenes = geneList, geneSel = topDiffGenes, nodeSize = 10,
annot = annFUN.db, affyLib = affyLib)
sampleGOdata
resultFisher = runTest(sampleGOdata, algorithm='classic', statistic='fisher')
resultFisher
resultKS = runTest(sampleGOdata, algorihtm='classic', statistic='ks')
resultKS.elim = runTest(sampleGOdata, algorithm='elim', statistic='ks')
library(genefilter)
BiocManager::install("genefilter")
ALL
geneID2GO <- readMappings(file = system.file("examples/geneid2go.map", package = "topGO"))
head(geneID2GO)
fdr = 0.1
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
condition = c("Control_T0","Control_T0","Control_T0",
"Control_T2","Control_T2","Control_T2",
"meJA_T2","meJA_T2","meJA_T2",
"Control_T6","Control_T6","Control_T6",
"meJA_T6","meJA_T6",
"Control_T24","Control_T24","Control_T24",
"meJA_T24","meJA_T24","meJA_T24")
sampleTable <- data.frame(sampleName = files.htseq,
fileName = files.htseq,
condition = condition)
sampleTable
fdr = 0.1
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
time = c("T0","T0","T0","T2","T2","T2","T2","T2","T2",
"T6","T6","T6","T6","T6","T24","T24","T24","T24","T24","T24")
treatment = c("untreated","untreated","untreated",
"untreated","untreated","untreated",
"treated","treated","treated",
"untreated","untreated","untreated",
"treated","treated",
"untreated","untreated","untreated",
"treated","treated","treated")
sampleTable <- data.frame(sampleName = files.htseq,
fileName = files.htseq,
time = time, treatment = treatment)
sampleTable
library("DESeq2")
ddsHTSeq <- DESeqDataSetFromHTSeqCount(sampleTable = sampleTable,
directory = dir.htseq,
design= ~ time + treatment + time:treatment)
library("DESeq2")
ddsHTSeq <- DESeqDataSetFromHTSeqCount(sampleTable = sampleTable,
directory = dir.htseq,
design= ~ condition)
## DE analysis using DESeq2
## input data format: htseq-count output
go = function(gList){
### GO enrichment analysis
setwd("C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/GO")
library(topGO)
geneID2GO <- readMappings(file = "Ntab.gene2go.newAnnot")
# the gene universe is given by the following line
# A total of 34056 genes get one or more GO terms assigned to it
geneNames = names(geneID2GO)
gene.of.interest = gList
gene.of.interest = as.integer(geneNames %in% gene.of.interest)
gene.of.interest = factor(gene.of.interest)
names(gene.of.interest) = geneNames # make it intno a named vector
GOdata = new("topGOdata", ontology="BP", allGenes=gene.of.interest,
annot=annFUN.gene2GO, gene2GO=geneID2GO)
test.stat = new("classicCount", testStatistic = GOFisherTest, name = "Fisher test")
resultFisher = getSigGroups(GOdata, test.stat)
pvals = score(resultFisher)
allRes = GenTable(GOdata, classic = resultFisher,
orderBy = "classic", ranksOf = "classic", topNodes = 20)
return (allRes)
}
fdr = 0.1
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
condition = c("Control_T0","Control_T0","Control_T0",
"Control_T2","Control_T2","Control_T2",
"meJA_T2","meJA_T2","meJA_T2",
"Control_T6","Control_T6","Control_T6",
"meJA_T6","meJA_T6",
"Control_T24","Control_T24","Control_T24",
"meJA_T24","meJA_T24","meJA_T24")
sampleTable <- data.frame(sampleName = files.htseq,
fileName = files.htseq,
condition = condition)
library("DESeq2")
ddsHTSeq <- DESeqDataSetFromHTSeqCount(sampleTable = sampleTable,
directory = dir.htseq,
design= ~ condition)
library("DESeq2")
install.packages("Rcpp")
## DE analysis using DESeq2
## input data format: htseq-count output
go = function(gList){
### GO enrichment analysis
setwd("C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/GO")
library(topGO)
geneID2GO <- readMappings(file = "Ntab.gene2go.newAnnot")
# the gene universe is given by the following line
# A total of 34056 genes get one or more GO terms assigned to it
geneNames = names(geneID2GO)
gene.of.interest = gList
gene.of.interest = as.integer(geneNames %in% gene.of.interest)
gene.of.interest = factor(gene.of.interest)
names(gene.of.interest) = geneNames # make it intno a named vector
GOdata = new("topGOdata", ontology="BP", allGenes=gene.of.interest,
annot=annFUN.gene2GO, gene2GO=geneID2GO)
test.stat = new("classicCount", testStatistic = GOFisherTest, name = "Fisher test")
resultFisher = getSigGroups(GOdata, test.stat)
pvals = score(resultFisher)
allRes = GenTable(GOdata, classic = resultFisher,
orderBy = "classic", ranksOf = "classic", topNodes = 20)
return (allRes)
}
fdr = 0.1
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
condition = c("Control_T0","Control_T0","Control_T0",
"Control_T2","Control_T2","Control_T2",
"meJA_T2","meJA_T2","meJA_T2",
"Control_T6","Control_T6","Control_T6",
"meJA_T6","meJA_T6",
"Control_T24","Control_T24","Control_T24",
"meJA_T24","meJA_T24","meJA_T24")
sampleTable <- data.frame(sampleName = files.htseq,
fileName = files.htseq,
condition = condition)
library("DESeq2")
ddsHTSeq <- DESeqDataSetFromHTSeqCount(sampleTable = sampleTable,
directory = dir.htseq,
design= ~ condition)
install.packages("RSQLite")
library("DESeq2")
fdr = 0.1
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
time = c("T0","T0","T0","T2","T2","T2","T2","T2","T2",
"T6","T6","T6","T6","T6","T24","T24","T24","T24","T24","T24")
treatment = c("untreated","untreated","untreated",
"untreated","untreated","untreated",
"treated","treated","treated",
"untreated","untreated","untreated",
"treated","treated",
"untreated","untreated","untreated",
"treated","treated","treated")
sampleTable <- data.frame(sampleName = files.htseq,
fileName = files.htseq,
time = time, treatment = treatment)
library("DESeq2")
ddsHTSeq <- DESeqDataSetFromHTSeqCount(sampleTable = sampleTable,
directory = dir.htseq,
design= ~ time + treatment + time:treatment)
sampleTable
fdr = 0.1
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
time = c("T0","T0","T0","T2","T2","T2","T2","T2","T2",
"T6","T6","T6","T6","T6","T24","T24","T24","T24","T24","T24")
treatment = c("untreated","untreated","untreated",
"untreated","untreated","untreated",
"treated","treated","treated",
"untreated","untreated","untreated",
"treated","treated",
"untreated","untreated","untreated",
"treated","treated","treated")
sampleTable <- data.frame(sampleName = files.htseq,
fileName = files.htseq,
time = time, treatment = treatment)
library("DESeq2")
ddsHTSeq <- DESeqDataSetFromHTSeqCount(sampleTable = sampleTable,
directory = dir.htseq,
design= ~ time + treatment)
ddsHTSeq
colData=data.frame(time=factor(time),treatment=factor(treatment))
colData
model.matrix(~time+treatment,colData)
model.matrix(~time+treatment+time:treatment,colData)
model.matrix(~time+treatment+time:treatment,colData)
fdr = 0.1
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
time = c("T0","T0","T0","T2","T2","T2","T2","T2","T2",
"T6","T6","T6","T6","T6","T24","T24","T24","T24","T24","T24")
treatment = c(0,0,0,0,0,0,1,1,1,0,0,0,1,1,0,0,0,1,1,1)
sampleTable <- data.frame(sampleName = files.htseq,
fileName = files.htseq,
time = time, treatment = factor(treatment))
colData=data.frame(time=time,treatment=factor(treatment))
model.matrix(~time+treatment+time:treatment,colData)
source("C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/GO/goModule.R")
fdr = 0.05
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq/NC95 vs NC95_nic(meJA)"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
time = c("T0","T0","T0","T2","T2","T2","T6","T6","T24","T24","T24",
"T0","T0","T2","T2","T6","T6","T24","T24")
genotype = c("nc95","nc95","nc95","nc95","nc95","nc95","nc95","nc95","nc95","nc95","nc95",
"nc95_nic","nc95_nic","nc95_nic","nc95_nic","nc95_nic","nc95_nic","nc95_nic","nc95_nic")
sampleTable = data.frame(sampleName = files.htseq,
fileName = files.htseq,
time = time, strain = genotype)
library("DESeq2")
ddsHTSeq = DESeqDataSetFromHTSeqCount(sampleTable = sampleTable,
directory = dir.htseq,
design= ~ time + strain + strain:time)
# The LRT test here identifies genes that show different expression profile
# between the two genotypes (NC95&NC95_nic) over time (at one or multiple time points)
dds.LRT = DESeq(ddsHTSeq, test="LRT", reduced = ~ time + strain)
res.LRT = results(dds.LRT)
res.LRT.ordered = res.LRT[order(res.LRT$padj),]
write.csv(as.data.frame(res.LRT.ordered), file="NC95.vs.NC95_nic.LRT.csv")
sig.gene.NC95.vs.NC95_nic = rownames(result[which(result$padj < fdr),])
go.sig.NC95.vs.NC95_nic = go(sig.gene.NC95.vs.NC95_nic)
sig.gene.NC95.vs.NC95_nic = rownames(result[which(res.LRT$padj < fdr),])
go.sig.NC95.vs.NC95_nic = go(sig.gene.NC95.vs.NC95_nic)
sig.gene.NC95.vs.NC95_nic = rownames(res.LRT[which(res.LRT$padj < fdr),])
go.sig.NC95.vs.NC95_nic = go(sig.gene.NC95.vs.NC95_nic)
go.sig.NC95.vs.NC95_nic
sampleTable
nc95(meJA) against Control
coldata = data.frame(time=time,strain=genotype)
model.matrix(~time+strain+time:strain,coldata)
betas = coef(dds.LRT)
library("pheatmap")
topGenes = head(order(res.LRT$padj),20)
#exclude columns that store betas for "Intercept" and "strain_nc95_nic_vs_nc95"
#only columns for time points and the interaction between time:strain are retained
# use colnames(betas[topGenes,]) to check this
mat = betas[topGenes, -c(1,5)]
thr = 3
mat[mat < -thr] <- -thr
mat[mat > thr] <- thr
pheatmap(mat, breaks=seq(from=-thr, to=thr, length=101),cluster_col=FALSE)
betas = coef(dds.LRT)
library("pheatmap")
topGenes = head(order(res.LRT$padj),200)
#exclude columns that store betas for "Intercept" and "strain_nc95_nic_vs_nc95"
#only columns for time points and the interaction between time:strain are retained
# use colnames(betas[topGenes,]) to check this
mat = betas[topGenes, -c(1,5)]
thr = 3
mat[mat < -thr] <- -thr
mat[mat > thr] <- thr
pheatmap(mat, breaks=seq(from=-thr, to=thr, length=101),cluster_col=FALSE)
colnames(betas)
?coef
attr(ddsHTSeq,"modelMatrix")
ddsHTSeq
betas = coef(dds.LRT)
library("pheatmap")
topGenes = head(order(res.LRT$padj),200)
#exclude columns that store betas for "Intercept" and "strain_nc95_nic_vs_nc95"
#only columns for time points and the interaction between time:strain are retained
# use colnames(betas[topGenes,]) to check this
mat = betas[topGenes, -c(1)]
thr = 3
mat[mat < -thr] <- -thr
mat[mat > thr] <- thr
pheatmap(mat, breaks=seq(from=-thr, to=thr, length=101),cluster_col=FALSE)
betas = coef(dds.LRT)
library("pheatmap")
topGenes = head(order(res.LRT$padj),100)
#exclude columns that store betas for "Intercept" and "strain_nc95_nic_vs_nc95"
#only columns for time points and the interaction between time:strain are retained
# use colnames(betas[topGenes,]) to check this
mat = betas[topGenes, -c(1)]
thr = 3
mat[mat < -thr] <- -thr
mat[mat > thr] <- thr
pheatmap(mat, breaks=seq(from=-thr, to=thr, length=101),cluster_col=FALSE)
betas = coef(dds.LRT)
library("pheatmap")
topGenes = head(order(res.LRT$padj),200)
#exclude columns that store betas for "Intercept" and "strain_nc95_nic_vs_nc95"
#only columns for time points and the interaction between time:strain are retained
# use colnames(betas[topGenes,]) to check this
mat = betas[topGenes, -c(1)]
thr = 3
mat[mat < -thr] <- -thr
mat[mat > thr] <- thr
pheatmap(mat, breaks=seq(from=-thr, to=thr, length=101),cluster_col=FALSE)
betas = coef(dds.LRT)
library("pheatmap")
topGenes = head(order(res.LRT$padj),200)
#exclude columns that store betas for "Intercept" and "strain_nc95_nic_vs_nc95"
#only columns for time points and the interaction between time:strain are retained
# use colnames(betas[topGenes,]) to check this
mat = betas[topGenes, -c(1,5)]
thr = 3
mat[mat < -thr] <- -thr
mat[mat > thr] <- thr
pheatmap(mat, breaks=seq(from=-thr, to=thr, length=101),cluster_col=FALSE)
files.htseq
## DE analysis using DESeq2
## input data format: htseq-count output
source("C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/GO/goModule.R")
fdr = 0.05
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq/Control vs meJA(NC95)"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
files.htseq
## DE analysis using DESeq2
## input data format: htseq-count output
source("C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/GO/goModule.R")
fdr = 0.05
dir.htseq = "C:/Users/10453/source/repos/SGN/nicotiana/subGenomeAssignment/DEseq2/htseq/Control vs meJA(NC95)"
files.htseq = grep("htseq",list.files(dir.htseq),value=TRUE)
time = c("T0","T0","T0","T2","T2","T2","T2","T2","T2",
"T6","T6","T6","T6","T6",
"T24","T24","T24","T24","T24","T24")
treated = c("N","N","N","N","N","N","Y","Y","Y",
"N","N","N","Y","Y","N","N","N","Y","Y","Y")
sampleTable <- data.frame(sampleName = files.htseq,
fileName = files.htseq,
time=time, treat=treated)
sampleTable
coldata = data.frame(time=time,treat=treated)
modoel.matrix(~time+treat+time:treat,coldata)
model.matrix(~time+treat+time:treat,coldata)
model.matrix(~time+treat+time:treat,coldata)
ls()
remove(list=ls())
ls()
